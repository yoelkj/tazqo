---
import Container from "./Container.astro";
import SectionTitle from "./SectionTitle.astro";
import CTAButton from "./CTAButton.astro";
import { BRAND, CONTACT, TAX } from "../config";

const {
  showAddons = true,
  kicker = "Precios",
  title = "Planes claros para empezar rápido",
  subtitle = `Setup único + mensualidad (hosting y soporte). ${TAX.note}`,
} = Astro.props;
---

<section id="precios" class="bg-slate-50">
  <Container class="py-20 md:py-24">
    <SectionTitle align="center" kicker={kicker} title={title} subtitle={subtitle} />

    <!-- ROOT del componente de precios -->
    <div data-pricing-root class="mt-6 flex flex-col items-center" data-billing="monthly">
      <!-- Toggle -->
      <div class="inline-flex rounded-xl border border-slate-200 bg-white p-1 shadow-elev-1">
        <button
          data-bill="monthly"
          aria-pressed="true"
          class="btn-toggle px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
        >
          MENSUAL
        </button>
        <button
          data-bill="annual"
          aria-pressed="false"
          class="btn-toggle px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
        >
          ANUAL
        </button>
      </div>
      <p class="mt-2 text-sm text-slate-500">Ahorra hasta 15% con plan anual.</p>

      <!-- Cards -->
      <div class={`mt-10 grid gap-6 ${showAddons ? "md:grid-cols-3" : "md:grid-cols-2"}`}>
        <!-- Card 1: Setup inicial -->
        <div class="bg-white rounded-2xl shadow-elev-2 border border-slate-200">
          <div class="p-8 text-center">
            <div class="mx-auto mb-4 h-20 w-20 rounded-full bg-indigo-50 flex items-center justify-center">
              <svg class="h-8 w-8 text-brand-indigo" viewBox="0 0 24 24" aria-label="Setup">
                <path fill="currentColor" d="M13 3a2 2 0 10-4 0H7a2 2 0 00-2 2v2a2 2 0 012 2 2 2 0 11-2 2v2a2 2 0 002 2h2a2 2 0 014 0h2a2 2 0 002-2v-2a2 2 0 010-4V5a2 2 0 00-2-2h-2z"/>
              </svg>
            </div>

            <h3 class="text-lg font-semibold text-slate-900">Setup inicial</h3>
            <div class="mt-3 text-4xl font-extrabold tracking-tight text-slate-900">S/ 600 – 1,200</div>
            <div class="text-sm text-slate-500">pago único</div>

            <ul class="mt-6 space-y-2 text-left text-slate-700">
              <li class="flex items-start gap-2">
                <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                <span>1 flujo prioritario entregable</span>
              </li>
              <li class="flex items-start gap-2">
                <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                <span>Conexión con tus herramientas</span>
              </li>
              <li class="flex items-start gap-2">
                <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                <span>Pruebas E2E y documentación</span>
              </li>
              <li class="flex items-start gap-2 opacity-60">
                <svg class="mt-1 h-5 w-5 flex-none text-slate-300" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                <span>Cambios ilimitados</span>
              </li>
              <li class="flex items-start gap-2 opacity-60">
                <svg class="mt-1 h-5 w-5 flex-none text-slate-300" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                <span>Soporte mensual</span>
              </li>
            </ul>

            <CTAButton target="_blank" class="mt-7 w-full" href={CONTACT.whatsappUrl} text="Solicitar evaluación" />
          </div>
        </div>

        <!-- Card 2: Mensualidad -->
        <div class="bg-white rounded-2xl shadow-elev-2 border border-slate-200 ring-2 ring-brand-indigo/15">
          <div class="p-8 text-center">
            <div class="mx-auto mb-4 h-20 w-20 rounded-full bg-indigo-50 flex items-center justify-center">
              <svg class="h-8 w-8 text-brand-indigo" viewBox="0 0 24 24" aria-label="Operación mensual">
                <path fill="currentColor" d="M12 9a3 3 0 100 6 3 3 0 000-6zm7.4 3.6l1.6.9-1.2 2.1-1.8-.3c-.3.2-.7.4-1 .6l-.3 1.7h-2.4l-.3-1.7c-.35-.17-.7-.37-1-.6l-1.8.3-1.2-2.1 1.6-.9a6 6 0 010-1.2l-1.6-.9 1.2-2.1 1.8.3c.31-.22.65-.42 1-.6l.3-1.7h2.4l.3 1.7c.35.18.69.38 1 .6l1.8-.3 1.2 2.1-1.6.9c.05.39.05.81 0 1.2z"/>
              </svg>
            </div>

            <h3 class="text-lg font-semibold text-slate-900">Mensualidad</h3>
            <div class="mt-3 text-4xl font-extrabold tracking-tight text-slate-900">
              <span class="price-monthly">S/ 150 – 350</span>
              <span class="price-annual hidden">S/ 127 – 298</span>
            </div>
            <div class="text-sm text-slate-500">por mes</div>

            <ul class="mt-6 space-y-2 text-left text-slate-700">
              <li class="flex items-start gap-2">
                <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                <span>Hosting de flujos</span>
              </li>
              <li class="flex items-start gap-2">
                <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                <span>Monitoreo y alertas</span>
              </li>
              <li class="flex items-start gap-2">
                <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                <span>Ajustes menores incluidos</span>
              </li>
              <li class="flex items-start gap-2">
                <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                <span>Escala con flujos adicionales</span>
              </li>
            </ul>

            <CTAButton target="_blank" class="mt-7 w-full" href={CONTACT.whatsappUrl} text="Quiero suscribirme" />
          </div>
        </div>

        {showAddons && (
          <div class="bg-white rounded-2xl shadow-elev-2 border border-slate-200">
            <div class="p-8 text-center">
              <div class="mx-auto mb-4 h-20 w-20 rounded-full bg-indigo-50 flex items-center justify-center">
                <svg class="h-8 w-8 text-brand-indigo" viewBox="0 0 24 24" aria-label="Add-ons">
                  <path fill="currentColor" d="M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2h5z"/>
                </svg>
              </div>

              <h3 class="text-lg font-semibold text-slate-900">Add-ons</h3>
              <div class="mt-3 text-4xl font-extrabold tracking-tight text-slate-900">A medida</div>
              <div class="text-sm text-slate-500">según alcance</div>

              <ul class="mt-6 space-y-2 text-left text-slate-700">
                <li class="flex items-start gap-2">
                  <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  <span>Flujo adicional</span>
                </li>
                <li class="flex items-start gap-2">
                  <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  <span>Integración nueva</span>
                </li>
                <li class="flex items-start gap-2">
                  <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  <span>Reporte/Cotización PDF</span>
                </li>
                <li class="flex items-start gap-2">
                  <svg class="mt-1 h-5 w-5 flex-none text-brand-indigo" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                  <span>Recordatorios y reseñas</span>
                </li>
              </ul>

              <CTAButton target="_blank" class="mt-7 w-full" href={CONTACT.whatsappUrl} text="Pedir cotización" />
            </div>
          </div>
        )}
      </div>
    </div>
  </Container>

  <!-- TOGGLE LÓGICO (sin IDs) -->
  <script is:inline>
    (() => {
      const host = document.currentScript?.closest('section') ?? document;
      const root = host.querySelector('[data-pricing-root]');
      if (!root) return;

      const btnM = root.querySelector('[data-bill="monthly"]');
      const btnA = root.querySelector('[data-bill="annual"]');

      // conjuntos de clases por estado
      const ACTIVE   = ['bg-brand-indigo','text-white','hover:bg-brand-indigo/90','focus-visible:outline','focus-visible:outline-2','focus-visible:outline-[color:var(--brand-indigo)]'];
      const INACTIVE = ['text-slate-700','hover:bg-slate-50'];

      function setBtnState(btn, active){
        btn.classList.remove(...(active ? INACTIVE : ACTIVE));
        btn.classList.add   (...(active ? ACTIVE   : INACTIVE));
        btn.setAttribute('aria-pressed', String(active));
      }

      function setMode(mode) {
        const isMonthly = mode === 'monthly';
        root.dataset.billing = mode;

        setBtnState(btnM, isMonthly);
        setBtnState(btnA, !isMonthly);

        root.querySelectorAll('.price-monthly').forEach(el => el.classList.toggle('hidden', !isMonthly));
        root.querySelectorAll('.price-annual').forEach(el => el.classList.toggle('hidden', isMonthly));
      }

      btnM?.addEventListener('click', () => setMode('monthly'));
      btnA?.addEventListener('click', () => setMode('annual'));

      // estado inicial
      setMode('monthly');
    })();
  </script>

  <!-- JSON-LD Service + Offers -->
  <script type="application/ld+json" is:inline>
    {JSON.stringify({
      "@context":"https://schema.org",
      "@type":"Service",
      "name":"Automatizaciones express para MYPEs",
      "areaServed":"PE",
      "provider":{"@type":"Organization","name": (BRAND?.name ?? "Tazqo")},
      "hasOfferCatalog":{
        "@type":"OfferCatalog",
        "name":"Planes Tazqo",
        "itemListElement":[
          {"@type":"Offer","name":"Setup inicial","priceSpecification":{"@type":"PriceSpecification","priceCurrency":"PEN","minPrice":600,"maxPrice":1200}},
          {"@type":"Offer","name":"Mensualidad","priceSpecification":{"@type":"PriceSpecification","priceCurrency":"PEN","minPrice":150,"maxPrice":350}}
        ]
      }
    })}
  </script>
</section>
